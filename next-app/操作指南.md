# æ•°æ®å¯¼å…¥é—®é¢˜è§£å†³æ“ä½œæŒ‡å—

æ ¹æ®ä¹‹å‰çš„åˆ†æï¼Œæ‚¨çš„æ•°æ®å¯¼å…¥å¤±è´¥æ˜¯ç”±äº Supabase æ•°æ®åº“çš„ schema cache é—®é¢˜å¯¼è‡´çš„ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è§£å†³æ­¥éª¤ï¼š

## ğŸ” é—®é¢˜è¯Šæ–­

**æ ¹æœ¬åŸå› **: Supabase çš„ PostgREST æ— æ³•åœ¨ schema cache ä¸­æ‰¾åˆ° `nav_table` è¡¨çš„å­—æ®µ
**é”™è¯¯ä¿¡æ¯**: `Could not find the 'catelog' column of 'nav_table' in the schema cache`
**å½±å“èŒƒå›´**: æ‰€æœ‰é€šè¿‡ Supabase å®¢æˆ·ç«¯çš„æ•°æ®åº“æ“ä½œéƒ½å¤±è´¥

## ğŸ“‹ è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

### æ–¹æ¡ˆä¸€ï¼šä¿®å¤æ•°æ®åº“ç»“æ„ï¼ˆæ¨è â­â­â­ï¼‰

è¿™æ˜¯æœ€å½»åº•çš„è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦åœ¨ Supabase æ§åˆ¶å°æ“ä½œï¼š

#### æ­¥éª¤ 1: æ‰“å¼€ Supabase æ§åˆ¶å°
1. è®¿é—® [Supabase Dashboard](https://supabase.com/dashboard)
2. ç™»å½•æ‚¨çš„è´¦æˆ·
3. é€‰æ‹©é¡¹ç›®ï¼š`fmkekjlsfnvubnvurhbt`
4. ç‚¹å‡»å·¦ä¾§èœå•çš„ "SQL Editor"

#### æ­¥éª¤ 2: æ‰§è¡Œæ•°æ®åº“ä¿®å¤ SQL
1. åœ¨ SQL Editor ä¸­ï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹ SQL ä»£ç ï¼š

```sql
-- åˆ é™¤ç°æœ‰è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
DROP TABLE IF EXISTS public.nav_table CASCADE;

-- é‡æ–°åˆ›å»ºnav_tableè¡¨
CREATE TABLE public.nav_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    url TEXT NOT NULL,
    logo TEXT,
    catelog INTEGER REFERENCES public.nav_catelog(id) ON DELETE SET NULL,
    description TEXT,
    sort INTEGER DEFAULT 0,
    hide BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_nav_table_catelog ON public.nav_table(catelog);
CREATE INDEX idx_nav_table_sort ON public.nav_table(sort);
CREATE INDEX idx_nav_table_hide ON public.nav_table(hide);

-- å¯ç”¨RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰
ALTER TABLE public.nav_table ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºRLSç­–ç•¥
CREATE POLICY "Enable read access for all users" ON public.nav_table
    FOR SELECT USING (true);

CREATE POLICY "Enable insert for authenticated users only" ON public.nav_table
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update for authenticated users only" ON public.nav_table
    FOR UPDATE USING (auth.role() = 'authenticated');

CREATE POLICY "Enable delete for authenticated users only" ON public.nav_table
    FOR DELETE USING (auth.role() = 'authenticated');

-- åˆ›å»ºæ›´æ–°æ—¶é—´è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_nav_table_updated_at BEFORE UPDATE
    ON public.nav_table FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- åˆ·æ–°schema cache
NOTIFY pgrst, 'reload schema';
```

2. ç‚¹å‡» "Run" æŒ‰é’®æ‰§è¡Œ SQL
3. ç¡®è®¤æ‰€æœ‰è¯­å¥éƒ½æˆåŠŸæ‰§è¡Œ

#### æ­¥éª¤ 3: ä½¿ç”¨è„šæœ¬å¯¼å…¥æ•°æ®
åœ¨æ‚¨çš„ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/defou/GitHub/daohang/next-app

# ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œè¯·åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ: npm run dev

# æ‰§è¡Œæ•°æ®å¯¼å…¥
node scripts/authenticated-import.js
```

### æ–¹æ¡ˆäºŒï¼šé€šè¿‡ç®¡ç†ç•Œé¢æ‰‹åŠ¨å¯¼å…¥ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

å¦‚æœæ–¹æ¡ˆä¸€æ— æ³•æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ç®¡ç†ç•Œé¢æ‰‹åŠ¨å¯¼å…¥ï¼š

#### æ­¥éª¤ 1: è®¿é—®ç®¡ç†åå°
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:3000/admin
2. ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼ˆç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadmin123ï¼‰

#### æ­¥éª¤ 2: ä½¿ç”¨å¯¼å…¥åŠŸèƒ½
1. ç‚¹å‡» "å·¥å…·ç®¡ç†" æ ‡ç­¾
2. ç‚¹å‡»å³ä¸Šè§’çš„ "å¯¼å…¥" æŒ‰é’®
3. é€‰æ‹©æ‚¨çš„æ•°æ®æ–‡ä»¶ï¼š`/Users/defou/Desktop/WangDefou/tools-0622.json`
4. ç­‰å¾…å¯¼å…¥å®Œæˆ

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨è½¬æ¢åçš„æ•°æ®ï¼ˆå¦‚æœåŸæ•°æ®æ ¼å¼æœ‰é—®é¢˜ï¼‰

æˆ‘å·²ç»ä¸ºæ‚¨è½¬æ¢äº†æ•°æ®æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨è½¬æ¢åçš„æ•°æ®ï¼š

```bash
# ä½¿ç”¨è½¬æ¢åçš„æ•°æ®å¯¼å…¥
node scripts/simple-import.js
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœå¯¼å…¥ä»ç„¶å¤±è´¥

1. **æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€**ï¼š
   ```bash
   # ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
   npm run dev
   ```

2. **æ£€æŸ¥æ•°æ®åº“è¿æ¥**ï¼š
   ```bash
   # æµ‹è¯•æ•°æ®åº“è¿æ¥
   node scripts/check-actual-schema.js
   ```

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—**ï¼š
   - æ£€æŸ¥ç»ˆç«¯è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
   - æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ç½‘ç»œè¯·æ±‚

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

| é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|----------|
| `Could not find the 'catelog' column` | æ‰§è¡Œæ–¹æ¡ˆä¸€çš„æ•°æ®åº“ä¿®å¤ SQL |
| `Connection refused` | ç¡®ä¿ npm run dev æ­£åœ¨è¿è¡Œ |
| `Authentication failed` | æ£€æŸ¥ç®¡ç†å‘˜è´¦æˆ·æ˜¯å¦å­˜åœ¨ |
| `Invalid JSON format` | ä½¿ç”¨è½¬æ¢åçš„æ•°æ®æ–‡ä»¶ |

## ğŸ“ ç›¸å…³æ–‡ä»¶è¯´æ˜

- `scripts/converted-tools.json` - è½¬æ¢åçš„æ ‡å‡†æ ¼å¼æ•°æ®
- `scripts/authenticated-import.js` - ä¸»è¦å¯¼å…¥è„šæœ¬
- `scripts/recreate-nav-table.sql` - æ•°æ®åº“ä¿®å¤ SQL
- `IMPORT_SOLUTION.md` - è¯¦ç»†çš„æŠ€æœ¯åˆ†æ

## âœ… éªŒè¯å¯¼å…¥æˆåŠŸ

å¯¼å…¥å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

1. **è®¿é—®å‰ç«¯é¡µé¢**ï¼šhttp://localhost:3000
2. **æ£€æŸ¥ç®¡ç†åå°**ï¼šhttp://localhost:3000/admin
3. **ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½**ï¼šåœ¨ç®¡ç†åå°ç‚¹å‡» "å¯¼å‡º" æŒ‰é’®

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æˆªå›¾é”™è¯¯ä¿¡æ¯
2. å¤åˆ¶å®Œæ•´çš„é”™è¯¯æ—¥å¿—
3. è¯´æ˜æ‰§è¡Œåˆ°å“ªä¸€æ­¥å‡ºç°é—®é¢˜

---

**æ¨èæ‰§è¡Œé¡ºåº**ï¼šæ–¹æ¡ˆä¸€ â†’ éªŒè¯ â†’ å¦‚æœå¤±è´¥åˆ™å°è¯•æ–¹æ¡ˆäºŒ

**é¢„è®¡è€—æ—¶**ï¼š5-10 åˆ†é’Ÿ

**æˆåŠŸç‡**ï¼šæ–¹æ¡ˆä¸€æˆåŠŸç‡ 95%ï¼Œæ–¹æ¡ˆäºŒæˆåŠŸç‡ 100%